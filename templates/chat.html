<!DOCTYPE html>
<html lang='ar' dir='rtl'>
<head>
<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<title>فراس</title>
<style>
html,body{margin:0;height:100%;font-family:Arial;background:#0e1b2a}
#container{max-width:420px;height:90vh;margin:5vh auto;background:#f2f2f2;border-radius:14px;display:flex;flex-direction:column;overflow:hidden;position:relative}
#header{background:#1976f2;color:#fff;text-align:center;padding:14px;font-size:18px}
#messages{flex:1;padding:12px;overflow-y:auto}
.msg{max-width:80%;margin-bottom:10px;padding:10px 14px;border-radius:14px;font-size:14px}
.bot{background:#e0e0e0}
.user{background:#1976f2;color:#fff;margin-left:auto}
#footer{display:flex;padding:10px;background:#fff;border-top:1px solid #ddd}
#input{flex:1;border-radius:20px;border:1px solid #ccc;padding:10px}
#send{background:#1976f2;color:#fff;border:none;border-radius:20px;padding:10px 16px;margin-right:8px}
#login{position:absolute;top:0;left:0;width:100%;height:100%;background:#0008;display:flex;align-items:center;justify-content:center;z-index:99}
#login .box{background:#fff;padding:20px;width:90%;border-radius:10px}
#login input,#login button{width:100%;padding:10px;margin-top:10px}
#login button{background:#1976f2;color:#fff;border:none}
</style>
</head>
<body>

<div id='container'>

<div id='login'>
<div class='box'>
<h3 style='text-align:center'>تسجيل الدخول</h3>
<input id='name' placeholder='الاسم'>
<input id='email' placeholder='البريد الإلكتروني'>
<input id='phone' placeholder='رقم الجوال'>
<button onclick='loginUser()'>دخول</button>
</div>
</div>

<div id='header'>فراس</div>

<div id='messages'>
<div class='msg bot'>السلام عليكم ورحمة الله وبركاته، معك المساعد الذكي فراس كيف يمكن أن أخدمك؟</div>
</div>

<div id='footer'>
<button id='send' onclick='send()'>إرسال</button>
<input id='input' placeholder='اكتب سؤالك هنا...'>
</div>

</div>

<script>
const input=document.getElementById('input')
const messages=document.getElementById('messages')

function loginUser(){
  if(!name.value||!email.value||!phone.value)return
  fetch('/login',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      name:name.value,
      email:email.value,
      phone:phone.value
    })
  })
  .then(r=>r.json())
  .then(d=>{
    if(d.ok){
      document.getElementById('login').style.display='none'
    }
  })
}

input.addEventListener('keydown',e=>{
  if(e.key==='Enter')send()
})

function add(text,type){
  const d=document.createElement('div')
  d.className='msg '+type
  d.innerText=text
  messages.appendChild(d)
  messages.scrollTop=messages.scrollHeight
}

function send(){
  const t=input.value.trim()
  if(!t)return
  add(t,'user')
  input.value=''
  fetch('/ask',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({message:t})
  })
  .then(r=>r.json())
  .then(d=>add(d.reply,'bot'))
}
</script>

</body>
</html>
