<!DOCTYPE html>
<html lang='ar' dir='rtl'>
<head>
<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<title>فراس</title>
<style>
html,body{margin:0;height:100%;font-family:Arial;background:#0e1b2a}
#container{max-width:420px;height:90vh;margin:5vh auto;background:#f2f2f2;border-radius:14px;display:flex;flex-direction:column;overflow:hidden;position:relative}
#header{background:#1976f2;color:#fff;text-align:center;padding:14px}
#messages{flex:1;padding:12px;overflow-y:auto}
.msg{max-width:80%;margin-bottom:10px;padding:10px;border-radius:14px}
.bot{background:#e0e0e0}
.user{background:#1976f2;color:#fff;margin-left:auto}
#footer{display:flex;padding:10px;background:#fff}
#input{flex:1;padding:10px;border-radius:20px;border:1px solid #ccc}
#send{background:#1976f2;color:#fff;border:none;border-radius:20px;padding:10px 16px;margin-right:8px}
#login,#rate{position:absolute;top:0;left:0;width:100%;height:100%;background:#0008;display:flex;align-items:center;justify-content:center;z-index:99}
.box{background:#fff;padding:20px;width:90%;border-radius:10px}
.box input,.box button{width:100%;padding:10px;margin-top:10px}
</style>
</head>
<body>

<div id='container'>

<div id='login'>
<div class='box'>
<input id='name' placeholder='الاسم'>
<input id='email' placeholder='البريد'>
<input id='phone' placeholder='الجوال'>
<button onclick='loginUser()'>دخول</button>
</div>
</div>

<div id='rate' style='display:none'>
<div class='box'>
<select id='rating'>
<option value='5'>⭐⭐⭐⭐⭐</option>
<option value='4'>⭐⭐⭐⭐</option>
<option value='3'>⭐⭐⭐</option>
<option value='2'>⭐⭐</option>
<option value='1'>⭐</option>
</select>
<button onclick='sendRate()'>إرسال التقييم</button>
</div>
</div>

<div id='header'>فراس</div>

<div id='messages'></div>

<div id='footer'>
<button id='send' onclick='send()'>إرسال</button>
<input id='input'>
</div>

</div>

<script>
const messages=document.getElementById('messages')
const input=document.getElementById('input')

function add(t,c){
  const d=document.createElement('div')
  d.className='msg '+c
  d.innerText=t
  messages.appendChild(d)
  messages.scrollTop=messages.scrollHeight
}

function loginUser(){
  fetch('/login',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({name:name.value,email:email.value,phone:phone.value})
  }).then(()=>login.style.display='none')
}

function send(){
  if(!input.value)return
  const q=input.value
  add(q,'user')
  input.value=''
  fetch('/ask',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({message:q})
  }).then(r=>r.json()).then(d=>{
    add(d.reply,'bot')
    setTimeout(()=>rate.style.display='flex',1500)
  })
}

function sendRate(){
  fetch('/rate',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({rating:rating.value})
  }).then(()=>location.reload())
}
</script>

</body>
</html>
