<!DOCTYPE html>
<html lang='ar' dir='rtl'>
<head>
<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<title>فراس</title>
<style>
html,body{margin:0;height:100%;font-family:Arial;background:#0e1b2a}
#container{max-width:420px;height:90vh;margin:5vh auto;background:#f2f2f2;border-radius:14px;display:flex;flex-direction:column;overflow:hidden;position:relative}
#header{background:#1976f2;color:#fff;text-align:center;padding:14px}
#messages{flex:1;padding:12px;overflow-y:auto}
.msg{max-width:80%;margin-bottom:10px;padding:10px;border-radius:14px}
.bot{background:#e0e0e0}
.user{background:#1976f2;color:#fff;margin-left:auto}
#footer{display:flex;padding:10px;background:#fff}
#input{flex:1;padding:10px;border-radius:20px;border:1px solid #ccc}
#send{background:#1976f2;color:#fff;border:none;border-radius:20px;padding:10px 16px;margin-right:8px}

#login{
  position:absolute;
  top:0;left:0;
  width:100%;height:100%;
  background:#0009;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:999
}
#loginBox{
  background:#fff;
  padding:20px;
  width:90%;
  border-radius:10px
}
#loginBox input,#loginBox button{
  width:100%;
  padding:10px;
  margin-top:10px
}
#loginBox button{
  background:#1976f2;
  color:#fff;
  border:none
}
</style>
</head>
<body>

<div id='container'>

<div id='login'>
  <div id='loginBox'>
    <h3 style='text-align:center'>تسجيل الدخول</h3>
    <input id='name'>
    <input id='email'>
    <input id='phone'>
    <button id='loginBtn'>دخول</button>
  </div>
</div>

<div id='header'>فراس</div>

<div id='messages'>
  <div class='msg bot'>السلام عليكم ورحمة الله وبركاته، معك المساعد الذكي فراس كيف يمكن أن أخدمك؟</div>
</div>

<div id='footer'>
  <button id='send'>إرسال</button>
  <input id='input'>
</div>

</div>

<script>
const loginBtn = document.getElementById('loginBtn')
const loginDiv = document.getElementById('login')
const input = document.getElementById('input')
const messages = document.getElementById('messages')

loginBtn.onclick = function(){
  if(!name.value || !email.value || !phone.value) return

  fetch('/login',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      name:name.value,
      email:email.value,
      phone:phone.value
    })
  })
  .then(r=>r.json())
  .then(d=>{
    if(d.ok === true){
      loginDiv.style.display = 'none'
    }
  })
}

document.getElementById('send').onclick = send
input.addEventListener('keydown',e=>{if(e.key==='Enter')send()})

function add(t,c){
  const d=document.createElement('div')
  d.className='msg '+c
  d.innerText=t
  messages.appendChild(d)
  messages.scrollTop=messages.scrollHeight
}

function send(){
  if(!input.value)return
  const q=input.value
  add(q,'user')
  input.value=''
  fetch('/ask',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({message:q})
  })
  .then(r=>r.json())
  .then(d=>add(d.reply,'bot'))
}
</script>

</body>
</html>
